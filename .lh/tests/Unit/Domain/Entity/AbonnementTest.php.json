{
    "sourceFile": "tests/Unit/Domain/Entity/AbonnementTest.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1766405476919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766406227135,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,16 +6,19 @@\n use App\\Domain\\Entity\\Abonnement;\r\n use App\\Domain\\Exception\\InvalidAbonnementException;\r\n use App\\Domain\\ValueObject\\AbonnementId;\r\n use App\\Domain\\ValueObject\\ParkingId;\r\n+use App\\Domain\\ValueObject\\SubscriptionOfferId;\r\n use App\\Domain\\ValueObject\\UserId;\r\n use PHPUnit\\Framework\\TestCase;\r\n \r\n final class AbonnementTest extends TestCase\r\n {\r\n     private AbonnementId $abonnementId;\r\n     private UserId $userId;\r\n     private ParkingId $parkingId;\r\n+    private SubscriptionOfferId $offerId;\r\n+\r\n     private array $weeklyTimeSlots;\r\n     private \\DateTimeImmutable $startDate;\r\n     private \\DateTimeImmutable $endDate;\r\n \r\n@@ -23,12 +26,17 @@\n     {\r\n         $this->abonnementId = AbonnementId::fromString('11111111-1111-4111-8111-111111111111');\r\n         $this->userId = UserId::fromString('22222222-2222-4222-8222-222222222222');\r\n         $this->parkingId = ParkingId::fromString('33333333-3333-4333-8333-333333333333');\r\n+\r\n+        // Offer liée à l'abonnement (nouvelle signature du constructeur)\r\n+        $this->offerId = new SubscriptionOfferId('offer_1');\r\n+\r\n         $this->weeklyTimeSlots = [\r\n             ['day' => 1, 'start' => '08:00', 'end' => '18:00'],\r\n             ['day' => 2, 'start' => '08:00', 'end' => '18:00'],\r\n         ];\r\n+\r\n         $this->startDate = new \\DateTimeImmutable('2025-01-01');\r\n         $this->endDate = new \\DateTimeImmutable('2025-03-01');\r\n     }\r\n \r\n@@ -50,8 +58,9 @@\n         new Abonnement(\r\n             $this->abonnementId,\r\n             $this->userId,\r\n             $this->parkingId,\r\n+            $this->offerId,\r\n             $this->weeklyTimeSlots,\r\n             $this->startDate,\r\n             $this->startDate\r\n         );\r\n@@ -64,8 +73,9 @@\n         new Abonnement(\r\n             $this->abonnementId,\r\n             $this->userId,\r\n             $this->parkingId,\r\n+            $this->offerId,\r\n             $this->weeklyTimeSlots,\r\n             new \\DateTimeImmutable('2025-01-01'),\r\n             new \\DateTimeImmutable('2026-02-01')\r\n         );\r\n@@ -78,8 +88,9 @@\n         new Abonnement(\r\n             $this->abonnementId,\r\n             $this->userId,\r\n             $this->parkingId,\r\n+            $this->offerId,\r\n             [],\r\n             $this->startDate,\r\n             $this->endDate\r\n         );\r\n@@ -92,8 +103,9 @@\n         new Abonnement(\r\n             $this->abonnementId,\r\n             $this->userId,\r\n             $this->parkingId,\r\n+            $this->offerId,\r\n             [['day' => 1, 'start' => '08:00']],\r\n             $this->startDate,\r\n             $this->endDate\r\n         );\r\n@@ -124,15 +136,17 @@\n     public function testCoversTimeSlotReturnsTrueForMatchingSlot(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n+        // 2025-01-06 = Lundi (day = 1)\r\n         self::assertTrue($abonnement->coversTimeSlot(new \\DateTimeImmutable('2025-01-06 10:00')));\r\n     }\r\n \r\n     public function testCoversTimeSlotReturnsFalseForNonMatchingDay(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n+        // 2025-01-08 = Mercredi (day = 3) et on n'a que day 1 et 2\r\n         self::assertFalse($abonnement->coversTimeSlot(new \\DateTimeImmutable('2025-01-08 10:00')));\r\n     }\r\n \r\n     public function testRenewSuccess(): void\r\n@@ -201,20 +215,17 @@\n         self::assertSame('expired', $abonnement->status());\r\n     }\r\n \r\n     private function createAbonnement(string $status = 'active'): Abonnement\r\n-{\r\n-    $offerId = new \\App\\Domain\\ValueObject\\SubscriptionOfferId('offer_1');\r\n-\r\n-    return new Abonnement(\r\n-        $this->abonnementId,\r\n-        $this->userId,\r\n-        $this->parkingId,\r\n-        $offerId,\r\n-        $this->weeklyTimeSlots,\r\n-        $this->startDate,\r\n-        $this->endDate,\r\n-        $status\r\n-    );\r\n+    {\r\n+        return new Abonnement(\r\n+            $this->abonnementId,\r\n\\ No newline at end of file\n+            $this->userId,\r\n+            $this->parkingId,\r\n+            $this->offerId,\r\n+            $this->weeklyTimeSlots,\r\n+            $this->startDate,\r\n+            $this->endDate,\r\n+            $status\r\n+        );\r\n+    }\r\n }\r\n-\r\n-}\n"
                },
                {
                    "date": 1766406824486,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,10 +27,12 @@\n         $this->abonnementId = AbonnementId::fromString('11111111-1111-4111-8111-111111111111');\r\n         $this->userId = UserId::fromString('22222222-2222-4222-8222-222222222222');\r\n         $this->parkingId = ParkingId::fromString('33333333-3333-4333-8333-333333333333');\r\n \r\n-        // Offer liée à l'abonnement (nouvelle signature du constructeur)\r\n-        $this->offerId = new SubscriptionOfferId('offer_1');\r\n+        // UUID valide obligatoire pour SubscriptionOfferId\r\n+        $this->offerId = SubscriptionOfferId::fromString(\r\n+            '44444444-4444-4444-8444-444444444444'\r\n+        );\r\n \r\n         $this->weeklyTimeSlots = [\r\n             ['day' => 1, 'start' => '08:00', 'end' => '18:00'],\r\n             ['day' => 2, 'start' => '08:00', 'end' => '18:00'],\r\n@@ -114,40 +116,50 @@\n     public function testIsActiveAtReturnsTrueForActiveAbonnement(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n-        self::assertTrue($abonnement->isActiveAt(new \\DateTimeImmutable('2025-02-01')));\r\n+        self::assertTrue($abonnement->isActiveAt(\r\n+            new \\DateTimeImmutable('2025-02-01')\r\n+        ));\r\n     }\r\n \r\n     public function testIsActiveAtReturnsFalseBeforeStartDate(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n-        self::assertFalse($abonnement->isActiveAt(new \\DateTimeImmutable('2024-12-31')));\r\n+        self::assertFalse($abonnement->isActiveAt(\r\n+            new \\DateTimeImmutable('2024-12-31')\r\n+        ));\r\n     }\r\n \r\n     public function testIsActiveAtReturnsFalseForSuspendedAbonnement(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n         $abonnement->suspend();\r\n \r\n-        self::assertFalse($abonnement->isActiveAt(new \\DateTimeImmutable('2025-02-01')));\r\n+        self::assertFalse($abonnement->isActiveAt(\r\n+            new \\DateTimeImmutable('2025-02-01')\r\n+        ));\r\n     }\r\n \r\n     public function testCoversTimeSlotReturnsTrueForMatchingSlot(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n-        // 2025-01-06 = Lundi (day = 1)\r\n-        self::assertTrue($abonnement->coversTimeSlot(new \\DateTimeImmutable('2025-01-06 10:00')));\r\n+        // 2025-01-06 = lundi (day = 1)\r\n+        self::assertTrue($abonnement->coversTimeSlot(\r\n+            new \\DateTimeImmutable('2025-01-06 10:00')\r\n+        ));\r\n     }\r\n \r\n     public function testCoversTimeSlotReturnsFalseForNonMatchingDay(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n-        // 2025-01-08 = Mercredi (day = 3) et on n'a que day 1 et 2\r\n-        self::assertFalse($abonnement->coversTimeSlot(new \\DateTimeImmutable('2025-01-08 10:00')));\r\n+        // 2025-01-08 = mercredi (day = 3)\r\n+        self::assertFalse($abonnement->coversTimeSlot(\r\n+            new \\DateTimeImmutable('2025-01-08 10:00')\r\n+        ));\r\n     }\r\n \r\n     public function testRenewSuccess(): void\r\n     {\r\n@@ -227,5 +239,5 @@\n             $this->endDate,\r\n             $status\r\n         );\r\n     }\r\n-}\n\\ No newline at end of file\n+}\r\n"
                },
                {
                    "date": 1766407073126,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,16 +27,16 @@\n         $this->abonnementId = AbonnementId::fromString('11111111-1111-4111-8111-111111111111');\r\n         $this->userId = UserId::fromString('22222222-2222-4222-8222-222222222222');\r\n         $this->parkingId = ParkingId::fromString('33333333-3333-4333-8333-333333333333');\r\n \r\n-        // UUID valide obligatoire pour SubscriptionOfferId\r\n-        $this->offerId = SubscriptionOfferId::fromString(\r\n-            '44444444-4444-4444-8444-444444444444'\r\n-        );\r\n+        // UUID valide obligatoire\r\n+        $this->offerId = SubscriptionOfferId::fromString('44444444-4444-4444-8444-444444444444');\r\n \r\n+        // Format attendu par l'entité Abonnement :\r\n+        // start_day, end_day, start_time, end_time\r\n         $this->weeklyTimeSlots = [\r\n-            ['day' => 1, 'start' => '08:00', 'end' => '18:00'],\r\n-            ['day' => 2, 'start' => '08:00', 'end' => '18:00'],\r\n+            ['start_day' => 1, 'end_day' => 1, 'start_time' => '08:00', 'end_time' => '18:00'],\r\n+            ['start_day' => 2, 'end_day' => 2, 'start_time' => '08:00', 'end_time' => '18:00'],\r\n         ];\r\n \r\n         $this->startDate = new \\DateTimeImmutable('2025-01-01');\r\n         $this->endDate = new \\DateTimeImmutable('2025-03-01');\r\n@@ -106,9 +106,12 @@\n             $this->abonnementId,\r\n             $this->userId,\r\n             $this->parkingId,\r\n             $this->offerId,\r\n-            [['day' => 1, 'start' => '08:00']],\r\n+            [\r\n+                // end_time manquant -> invalide\r\n+                ['start_day' => 1, 'end_day' => 1, 'start_time' => '08:00'],\r\n+            ],\r\n             $this->startDate,\r\n             $this->endDate\r\n         );\r\n     }\r\n@@ -116,50 +119,40 @@\n     public function testIsActiveAtReturnsTrueForActiveAbonnement(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n-        self::assertTrue($abonnement->isActiveAt(\r\n-            new \\DateTimeImmutable('2025-02-01')\r\n-        ));\r\n+        self::assertTrue($abonnement->isActiveAt(new \\DateTimeImmutable('2025-02-01')));\r\n     }\r\n \r\n     public function testIsActiveAtReturnsFalseBeforeStartDate(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n-        self::assertFalse($abonnement->isActiveAt(\r\n-            new \\DateTimeImmutable('2024-12-31')\r\n-        ));\r\n+        self::assertFalse($abonnement->isActiveAt(new \\DateTimeImmutable('2024-12-31')));\r\n     }\r\n \r\n     public function testIsActiveAtReturnsFalseForSuspendedAbonnement(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n         $abonnement->suspend();\r\n \r\n-        self::assertFalse($abonnement->isActiveAt(\r\n-            new \\DateTimeImmutable('2025-02-01')\r\n-        ));\r\n+        self::assertFalse($abonnement->isActiveAt(new \\DateTimeImmutable('2025-02-01')));\r\n     }\r\n \r\n     public function testCoversTimeSlotReturnsTrueForMatchingSlot(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n-        // 2025-01-06 = lundi (day = 1)\r\n-        self::assertTrue($abonnement->coversTimeSlot(\r\n-            new \\DateTimeImmutable('2025-01-06 10:00')\r\n-        ));\r\n+        // 2025-01-06 = lundi (start_day = 1)\r\n+        self::assertTrue($abonnement->coversTimeSlot(new \\DateTimeImmutable('2025-01-06 10:00')));\r\n     }\r\n \r\n     public function testCoversTimeSlotReturnsFalseForNonMatchingDay(): void\r\n     {\r\n         $abonnement = $this->createAbonnement();\r\n \r\n-        // 2025-01-08 = mercredi (day = 3)\r\n-        self::assertFalse($abonnement->coversTimeSlot(\r\n-            new \\DateTimeImmutable('2025-01-08 10:00')\r\n-        ));\r\n+        // 2025-01-08 = mercredi (day = 3), pas couvert (on n'a que 1 et 2)\r\n+        self::assertFalse($abonnement->coversTimeSlot(new \\DateTimeImmutable('2025-01-08 10:00')));\r\n     }\r\n \r\n     public function testRenewSuccess(): void\r\n     {\r\n"
                }
            ],
            "date": 1766405476919,
            "name": "Commit-0",
            "content": "<?php\r\ndeclare(strict_types=1);\r\n\r\nnamespace Tests\\Unit\\Domain\\Entity;\r\n\r\nuse App\\Domain\\Entity\\Abonnement;\r\nuse App\\Domain\\Exception\\InvalidAbonnementException;\r\nuse App\\Domain\\ValueObject\\AbonnementId;\r\nuse App\\Domain\\ValueObject\\ParkingId;\r\nuse App\\Domain\\ValueObject\\UserId;\r\nuse PHPUnit\\Framework\\TestCase;\r\n\r\nfinal class AbonnementTest extends TestCase\r\n{\r\n    private AbonnementId $abonnementId;\r\n    private UserId $userId;\r\n    private ParkingId $parkingId;\r\n    private array $weeklyTimeSlots;\r\n    private \\DateTimeImmutable $startDate;\r\n    private \\DateTimeImmutable $endDate;\r\n\r\n    protected function setUp(): void\r\n    {\r\n        $this->abonnementId = AbonnementId::fromString('11111111-1111-4111-8111-111111111111');\r\n        $this->userId = UserId::fromString('22222222-2222-4222-8222-222222222222');\r\n        $this->parkingId = ParkingId::fromString('33333333-3333-4333-8333-333333333333');\r\n        $this->weeklyTimeSlots = [\r\n            ['day' => 1, 'start' => '08:00', 'end' => '18:00'],\r\n            ['day' => 2, 'start' => '08:00', 'end' => '18:00'],\r\n        ];\r\n        $this->startDate = new \\DateTimeImmutable('2025-01-01');\r\n        $this->endDate = new \\DateTimeImmutable('2025-03-01');\r\n    }\r\n\r\n    public function testConstructValidAbonnement(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        self::assertInstanceOf(Abonnement::class, $abonnement);\r\n        self::assertSame($this->abonnementId, $abonnement->id());\r\n        self::assertSame($this->userId, $abonnement->userId());\r\n        self::assertSame($this->parkingId, $abonnement->parkingId());\r\n        self::assertSame('active', $abonnement->status());\r\n    }\r\n\r\n    public function testConstructWithInvalidDurationThrowsException(): void\r\n    {\r\n        $this->expectException(InvalidAbonnementException::class);\r\n\r\n        new Abonnement(\r\n            $this->abonnementId,\r\n            $this->userId,\r\n            $this->parkingId,\r\n            $this->weeklyTimeSlots,\r\n            $this->startDate,\r\n            $this->startDate\r\n        );\r\n    }\r\n\r\n    public function testConstructWithTooLongDurationThrowsException(): void\r\n    {\r\n        $this->expectException(InvalidAbonnementException::class);\r\n\r\n        new Abonnement(\r\n            $this->abonnementId,\r\n            $this->userId,\r\n            $this->parkingId,\r\n            $this->weeklyTimeSlots,\r\n            new \\DateTimeImmutable('2025-01-01'),\r\n            new \\DateTimeImmutable('2026-02-01')\r\n        );\r\n    }\r\n\r\n    public function testConstructWithEmptyTimeSlotsThrowsException(): void\r\n    {\r\n        $this->expectException(InvalidAbonnementException::class);\r\n\r\n        new Abonnement(\r\n            $this->abonnementId,\r\n            $this->userId,\r\n            $this->parkingId,\r\n            [],\r\n            $this->startDate,\r\n            $this->endDate\r\n        );\r\n    }\r\n\r\n    public function testConstructWithInvalidTimeSlotThrowsException(): void\r\n    {\r\n        $this->expectException(InvalidAbonnementException::class);\r\n\r\n        new Abonnement(\r\n            $this->abonnementId,\r\n            $this->userId,\r\n            $this->parkingId,\r\n            [['day' => 1, 'start' => '08:00']],\r\n            $this->startDate,\r\n            $this->endDate\r\n        );\r\n    }\r\n\r\n    public function testIsActiveAtReturnsTrueForActiveAbonnement(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        self::assertTrue($abonnement->isActiveAt(new \\DateTimeImmutable('2025-02-01')));\r\n    }\r\n\r\n    public function testIsActiveAtReturnsFalseBeforeStartDate(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        self::assertFalse($abonnement->isActiveAt(new \\DateTimeImmutable('2024-12-31')));\r\n    }\r\n\r\n    public function testIsActiveAtReturnsFalseForSuspendedAbonnement(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n        $abonnement->suspend();\r\n\r\n        self::assertFalse($abonnement->isActiveAt(new \\DateTimeImmutable('2025-02-01')));\r\n    }\r\n\r\n    public function testCoversTimeSlotReturnsTrueForMatchingSlot(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        self::assertTrue($abonnement->coversTimeSlot(new \\DateTimeImmutable('2025-01-06 10:00')));\r\n    }\r\n\r\n    public function testCoversTimeSlotReturnsFalseForNonMatchingDay(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        self::assertFalse($abonnement->coversTimeSlot(new \\DateTimeImmutable('2025-01-08 10:00')));\r\n    }\r\n\r\n    public function testRenewSuccess(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n        $newEndDate = new \\DateTimeImmutable('2025-06-01');\r\n\r\n        $abonnement->renew($newEndDate);\r\n\r\n        self::assertSame($newEndDate, $abonnement->endDate());\r\n    }\r\n\r\n    public function testRenewWithPastDateThrowsException(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        $this->expectException(InvalidAbonnementException::class);\r\n\r\n        $abonnement->renew(new \\DateTimeImmutable('2025-02-01'));\r\n    }\r\n\r\n    public function testSuspendSuccess(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        $abonnement->suspend();\r\n\r\n        self::assertSame('suspended', $abonnement->status());\r\n    }\r\n\r\n    public function testSuspendAlreadySuspendedThrowsException(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n        $abonnement->suspend();\r\n\r\n        $this->expectException(InvalidAbonnementException::class);\r\n\r\n        $abonnement->suspend();\r\n    }\r\n\r\n    public function testReactivateSuccess(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n        $abonnement->suspend();\r\n\r\n        $abonnement->reactivate();\r\n\r\n        self::assertSame('active', $abonnement->status());\r\n    }\r\n\r\n    public function testReactivateNonSuspendedThrowsException(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        $this->expectException(InvalidAbonnementException::class);\r\n\r\n        $abonnement->reactivate();\r\n    }\r\n\r\n    public function testExpireSuccess(): void\r\n    {\r\n        $abonnement = $this->createAbonnement();\r\n\r\n        $abonnement->expire();\r\n\r\n        self::assertSame('expired', $abonnement->status());\r\n    }\r\n\r\n    private function createAbonnement(string $status = 'active'): Abonnement\r\n{\r\n    $offerId = new \\App\\Domain\\ValueObject\\SubscriptionOfferId('offer_1');\r\n\r\n    return new Abonnement(\r\n        $this->abonnementId,\r\n        $this->userId,\r\n        $this->parkingId,\r\n        $offerId,\r\n        $this->weeklyTimeSlots,\r\n        $this->startDate,\r\n        $this->endDate,\r\n        $status\r\n    );\r\n}\r\n\r\n}"
        }
    ]
}